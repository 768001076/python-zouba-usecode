import socket
import requests
import time
from HttpMethod import ThreadPoolComplex
from dubbo_client.rpclib import DubboClient
from dubbo_client.registry import ZookeeperRegistry
from dubbo_client.config import ApplicationConfig
from HttpMethod.ThreadPoolComplex import ThreadPool


def getInterHost():
    myname = socket.gethostname()  # 获取计算机名称
    myaddr = socket.gethostbyname(myname)  # 获取ip地址
    return myaddr


def proxyaddRepMessage():
    param = 'jsonStr={"intraneIp":"192.168.0.152","outNetIp":"","proxyBean":{"canUse":false,"proxyIp":"125.121.119.112","proxyPort":3138,"useProxy":false},"webPort":"9090"}'
    result = requests.post(url="http://127.0.0.1:8080/Proxy/ProxyMessage/addRepMessage", data=param)
    print(result.headers)
    print(result.text)


def proxy_getSwitch():
    # pool = ThreadPoolComplex.ThreadPool(10)
    # while True:
    #     for i in range(10):
    #         pool.run(func=proxy_getSwitch)
    #     time.sleep(1)
    try:
        # proxy.hangtian123.net
        # 127.0.0.1:2653
        result = requests.get(url="http://proxy.hangtian123.net/Proxy/ProxySwitch/getProxySwitch")
    except:
        print("关闭了一个连接")

    print(result.status_code)
    result.close()


def proxy_request(url, method="GET", param=None, headers=None, proxies=None, timeout=10):
    if url is not "":
        result = requests.request(method=method, url=url, headers=headers, proxies=proxies, timeout=timeout)
    else:
        result = "无连接"
    return result


def get_proxyInfo():
    result = "-1"
    # try:
    config = ApplicationConfig("test_rpclib")
    server_interface = "com.dubbo.service.DubboRepServerIPService"
    registry = ZookeeperRegistry("120.26.100.222:2181", config)
    vpsServerIpsProvider = DubboClient(server_interface, registry)
    result = vpsServerIpsProvider.getVpsRepServerInfoBean(1)
    # except Exception as ex:
    #     result = "获取代理信息异常:" + str(ex)
    #     print(ex)
    return result


def proxyTest(proxies):
    try:
        # print(proxies,'Start:',time.strftime("%Y-%m-%d %H:%M:%S",time.localtime()))
        result = proxy_request(
            url="https://kyfw.12306.cn/otn/leftTicket/init",
            # url="https://www.baidu.com/",
            timeout=5,
            headers=headers,
            proxies=proxies)
        if result.status_code != 200 or str(result.content.decode('utf-8')).find('成都') == 0:
            print(proxies, result.status_code, result.content.decode('utf-8'))
        else:
            print(proxies, 'success', result.status_code)
        # print(proxies, result.status_code, result.content.decode('utf-8'))
        # print(proxies,'End:',time.strftime("%Y-%m-%d %H:%M:%S",time.localtime()))
    except Exception as e:
        print(proxies, e)
        # print(proxies, "connection timeout")
        # print(proxies, 'Error:', time.strftime("%Y-%m-%d %H:%M:%S", time.localtime()))


if __name__ == '__main__':
    # result = get_proxyInfo()
    # print(result)
    headers = {
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
        "Accept-Encoding": "gzip, deflate",
        "Accept-Language": "en-US,en;q=0.5",
        "Connection": "keep-alive",
        "User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:39.0) Gecko/20100101 Firefox/39.0"
    }
    proxys = [
        "https://60.178.155.115:3138",
        "https://60.179.108.48:3138",
        "https://115.217.53.17:3138",
        "https://125.115.83.167:3138",
        "https://115.217.71.180:3138",
        "https://60.178.155.131:3138",
        "https://114.227.17.25:3138",
        "https://114.226.65.162:3138",
        "https://125.115.83.32:3138",
        "https://222.185.137.196:3138",
        "https://117.63.78.76:3138",
        "https://125.115.82.233:3138",
        "https://125.115.92.218:3138",
        "https://125.115.95.15:3138",
        "https://122.246.32.209:3138",
        "https://60.179.109.42:3138",
        "https://60.178.154.218:3138",
        "https://115.217.68.32:3138",
        "https://125.115.91.61:3138",
        "https://115.217.70.205:3138",
        "https://125.115.88.72:3138",
        "https://122.246.32.100:3138",
        "https://125.115.92.253:3138",
        "https://115.217.69.75:3138",
        "https://115.217.53.165:3138",
        "https://125.115.87.181:3138",
        "https://122.246.33.17:3138",
        "https://125.115.83.150:3138",
        "https://115.217.52.193:3138",
        "https://125.115.84.142:3138",
        "https://115.217.52.33:3138",
        "https://115.214.73.185:3138",
        "https://115.217.70.222:3138",
        "https://115.214.253.44:3138",
        "https://115.217.69.197:3138",
        "https://115.214.254.186:3138",
        "https://60.179.110.239:3138",
        "https://115.217.52.167:3138",
        "https://122.246.32.55:3138",
        "https://222.185.22.200:3138",
        "https://115.217.53.214:3138",
        "https://114.228.73.85:3138",
        "https://114.228.75.78:3138",
        "https://121.231.168.203:3138",
        "https://114.228.75.97:3138",
        "https://121.231.155.121:3138",
        "https://60.179.110.130:3138",
        "https://60.178.152.37:3138",
        "https://125.115.85.23:3138",
        "https://115.214.78.167:3138",
        "https://115.214.255.104:3138",
        "https://115.214.75.118:3138",
        "https://114.226.105.35:3138",
        "https://115.217.52.242:3138",
        "https://220.184.215.127:3138",
        "https://115.214.255.44:3138",
        "https://125.115.90.255:3138",
        "https://125.115.89.238:3138",
        "https://122.246.32.88:3138",
        "https://60.179.109.192:3138",
        "https://115.214.79.44:3138",
        "https://125.115.93.109:3138",
        "https://125.115.93.180:3138",
        "https://115.217.71.24:3138",
        "https://60.179.111.137:3138",
        "https://122.246.33.194:3138",
        "https://115.214.79.198:3138",
        "https://125.115.88.212:3138",
        "https://115.214.253.92:3138",
        "https://125.115.93.231:3138",
        "https://122.246.35.164:3138",
        "https://115.214.254.225:3138",
        "https://122.246.35.162:3138",
        "https://122.246.33.153:3138",
        "https://115.214.252.52:3138",
        "https://222.185.137.234:3138",
        "https://115.214.76.117:3138",
        "https://121.231.168.241:3138",
        "https://114.226.105.179:3138",
        "https://117.63.78.251:3138",
        "https://60.178.152.150:3138",
        "https://122.246.32.82:3138",
        "https://115.217.70.215:3138",
        "https://60.178.152.207:3138",
        "https://115.217.70.24:3138",
        "https://125.120.204.183:3138",
        "https://115.214.79.153:3138",
        "https://125.120.11.151:3138",
        "https://125.121.118.47:3138",
        "https://60.176.233.139:3138",
        "https://125.118.146.134:3138",
        "https://115.198.35.227:3138",
        "https://220.191.13.174:3138",
        "https://115.204.25.142:3138",
        "https://125.118.76.1:3138",
        "https://125.120.207.96:3138",
        "https://60.176.234.86:3138",
        "https://60.176.233.41:3138",
        "https://125.122.119.182:3138",
        "https://220.191.13.13:3138",
        "https://125.122.170.52:3138",
        "https://115.198.36.245:3138",
        "https://125.121.116.140:3138",
        "https://115.217.71.12:3138",
        "https://115.198.38.202:3138",
        "https://125.118.144.49:3138",
        "https://125.118.73.162:3138",
        "https://125.118.76.226:3138",
        "https://125.121.118.181:3138",
        "https://115.217.53.184:3138",
        "https://183.128.242.220:3138",
        "https://125.122.117.254:3138",
        "https://115.214.76.204:3138",
        "https://125.120.206.82:3138",
        "https://125.120.206.82:3138",
        "https://125.120.205.100:3138",
        "https://125.118.151.71:3138",
        "https://125.118.147.243:3138",
        "https://60.178.153.57:3138",
        "https://60.178.152.46:3138",
        "https://220.191.102.62:3138",
        "https://60.178.152.231:3138",
        "https://183.128.241.182:3138",
        "https://115.217.70.47:3138",
        "https://125.120.205.228:3138",
        "https://122.246.32.77:3138",
        "https://125.120.201.111:3138",
        "https://60.179.110.190:3138",
        "https://115.217.71.89:3138",
        "https://125.120.9.225:3138",
        "https://125.120.207.130:3138",
        "https://125.118.77.51:3138",
        "https://125.120.8.148:3138",
        "https://60.178.155.168:3138",
        "https://115.198.32.185:3138",
        "https://125.118.74.49:3138",
        "https://60.178.154.162:3138",
        "https://220.191.102.224:3138",
        "https://60.176.239.173:3138",
        "https://60.178.154.149:3138",
        "https://60.176.238.130:3138",
        "https://115.217.52.157:3138",
        "https://125.118.148.247:3138",
        "https://115.198.37.195:3138",
        "https://115.204.27.159:3138",
        "https://60.178.155.100:3138",
        "https://115.198.33.22:3138",
        "https://115.198.39.141:3138",
        "https://125.115.83.72:3138",
        "https://125.121.112.169:3138",
        "https://125.115.95.233:3138",
        "https://60.178.153.124:3138",
        "https://60.178.153.155:3138",
        "https://122.246.32.81:3138",
        "https://125.120.205.191:3138",
        "https://115.214.252.222:3138",
        "https://115.214.253.137:3138",
        "https://125.120.205.170:3138",
        "https://115.198.34.130:3138",
        "https://60.179.108.190:3138",
        "https://115.214.254.219:3138",
        "https://115.214.79.153:3138",
        "https://125.118.149.82:3138",
        "https://125.118.147.108:3138",
        "https://115.198.39.33:3138",
        "https://125.115.90.251:3138",
        "https://114.228.73.30:3138",
        "https://114.226.65.218:3138",
        "https://121.231.168.17:3138",
        "https://58.216.61.49:3138",
        "https://114.228.73.131:3138",
        "https://114.226.135.153:3138",
        "https://222.185.23.16:3138",
        "https://58.216.61.164:3138",
        "https://121.231.154.70:3138",
        "https://222.185.22.61:3138",
        "https://222.185.22.61:3138",
        "https://114.226.65.200:3138",
        "https://114.226.65.200:3138",
        "https://121.231.155.80:3138",
        "https://121.231.155.80:3138",
        "https://114.226.135.178:3138",
        "https://114.226.135.178:3138",
        "https://121.231.155.41:3138",
        "https://121.231.154.138:3138",
        "https://58.216.61.133:3138",
        "https://121.231.32.116:3138",
        "https://222.185.22.163:3138",
        "https://121.231.32.132:3138",
        "https://114.228.75.192:3138",
        "https://222.185.23.166:3138",
        "https://114.226.135.106:3138",
        "https://222.185.160.129:3138",
        "https://121.231.155.216:3138",
        "https://222.185.23.70:3138",
        "https://121.231.32.100:3138",
        "https://114.228.73.102:3138",
        "https://114.226.128.153:3138",
        "https://114.226.65.69:3138",
        "https://114.226.65.137:3138",
        "https://121.231.168.84:3138",
        "https://222.185.160.199:3138",
        "https://121.231.226.136:3138",
        "https://114.228.74.137:3138",
        "https://114.228.73.3:3138",
        "https://222.185.22.250:3138",
        "https://117.63.78.249:3138",
        "https://114.226.135.56:3138",
        "https://114.226.105.184:3138",
        "https://114.228.74.154:3138",
        "https://58.216.61.254:3138",
        "https://114.228.74.195:3138",
        "https://222.185.23.173:3138",
        "https://121.231.155.118:3138",
        "https://114.226.65.53:3138",
        "https://222.185.23.65:3138",
        "https://222.185.23.129:3138",
        "https://114.226.135.150:3138",
        "https://114.226.135.250:3138",
        "https://114.226.105.92:3138",
        "https://114.226.105.211:3138",
        "https://222.185.22.90:3138",
        "https://114.226.128.156:3138",
        "https://121.231.226.153:3138",
        "https://121.231.155.51:3138",
        "https://114.228.75.226:3138",
        "https://125.118.150.205:3138",
        "https://114.228.75.168:3138",
        "https://125.121.114.7:3138",
        "https://222.185.22.236:3138",
        "https://60.176.239.114:3138",
        "https://115.214.73.33:3138",
        "https://114.228.75.19:3138",
        "https://58.216.61.5:3138",
        "https://222.185.160.192:3138",
        "https://222.185.160.153:3138",
        "https://114.228.75.63:3138",
        "https://114.226.135.28:3138",
        "https://222.185.22.34:3138",
        "https://222.185.137.174:3138",
        "https://114.226.65.214:3138",
        "https://121.231.32.89:3138",
        "https://222.185.22.245:3138",
        "https://222.185.160.9:3138",
        "https://222.185.137.244:3138",
        "https://121.231.168.227:3138",
        "https://114.226.105.170:3138",
        "https://60.178.155.29:3138",
        "https://220.191.102.65:3138",
        "https://125.118.76.185:3138",
        "https://58.216.61.203:3138",
        "https://114.228.74.173:3138",
        "https://114.226.135.67:3138",
        "https://220.191.102.43:3138",
        "https://115.214.78.165:3138",
        "https://60.178.153.240:3138",
        "https://125.120.201.158:3138",
        "https://60.178.155.184:3138",
        "https://115.198.34.140:3138",
        "https://60.178.152.182:3138",
        "https://183.128.243.184:3138",
        "https://183.128.241.142:3138",
        "https://125.121.116.58:3138",
        "https://220.191.101.229:3138",
        "https://60.178.152.130:3138",
        "https://115.214.253.212:3138",
        "https://115.198.35.240:3138",
        "https://122.246.33.218:3138",
        "https://125.120.11.130:3138",
        "https://125.122.168.80:3138",
        "https://115.214.79.63:3138",
        "https://183.128.243.2:3138",
        "https://115.214.78.37:3138",
        "https://115.214.252.44:3138",
        "https://115.214.255.24:3138",
        "https://125.115.92.98:3138",
        "https://125.115.81.158:3138",
        "https://60.179.108.213:3138",
        "https://125.122.168.139:3138",
        "https://115.204.25.207:3138",
        "https://115.214.75.37:3138",
        "https://115.214.78.180:3138",
        "https://125.115.81.196:3138",
        "https://60.179.111.181:3138",
        "https://60.179.109.137:3138",
        "https://115.214.254.155:3138",
        "https://115.214.255.53:3138",
        "https://115.217.68.73:3138",
        "https://60.178.152.28:3138",
        "https://115.214.78.199:3138",
        "https://115.217.71.220:3138",
        "https://60.178.152.101:3138",
        "https://125.115.90.221:3138",
        "https://115.214.75.107:3138",
        "https://125.115.83.122:3138",
        "https://60.176.239.191:3138",
        "https://125.121.122.199:3138",
        "https://125.121.120.26:3138",
        "https://125.120.201.224:3138",
        "https://115.204.29.159:3138",
        "https://125.121.116.109:3138",
        "https://125.120.11.18:3138",
        "https://115.198.38.164:3138",
        "https://115.198.37.207:3138",
        "https://183.128.240.197:3138",
        "https://125.118.150.227:3138",
        "https://125.120.8.20:3138",
        "https://125.118.144.24:3138",
        "https://125.118.150.71:3138",
        "https://125.120.207.41:3138",
        "https://125.121.122.110:3138",
        "https://125.120.10.29:3138",
        "https://125.120.9.251:3138",
        "https://115.214.73.113:3138",
        "https://115.217.52.155:3138",
        "https://60.178.155.60:3138",
        "https://125.115.90.235:3138",
        "https://115.198.38.37:3138",
        "https://125.120.9.208:3138",
        "https://60.178.152.26:3138",
        "https://125.115.81.143:3138",
        "https://115.214.74.128:3138",
        "https://125.115.93.60:3138",
        "https://115.204.27.142:3138",
        "https://125.118.241.67:3138",
        "https://125.120.9.82:3138",
        "https://115.204.24.127:3138",
        "https://125.118.150.157:3138",
        "https://115.214.253.189:3138",
        "https://115.214.72.17:3138",
        "https://60.178.152.198:3138",
        "https://115.214.79.49:3138",
        "https://60.179.110.126:3138",
        "https://60.178.154.147:3138",
        "https://60.178.153.226:3138",
        "https://60.179.108.75:3138",
        "https://60.178.155.138:3138"
    ]
    proxies = {
        "https": "http://114.228.73.57:3138"
    }
    for proxy in proxys:
        proxies["https"] = proxy
        proxyTest(proxies)
    # pool = ThreadPoolComplex.ThreadPool(3)
    # while True:
    #     for i in range(3):
    #         pool.run(func=proxy_getSwitch)
    #     time.sleep(1)
